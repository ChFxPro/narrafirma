<!DOCTYPE html> 
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>NarraFirma</title>

<link rel="stylesheet" href="lib/humane/original.css">
<link rel="stylesheet" href="css/survey.css">
<link rel="stylesheet" href="css/standard.css">

<script>
var require = {
    baseUrl: '',
    waitSeconds: 60,
    paths: {
        js: "js",
        mithril: "lib/mithril/mithril",
        d3: "lib/d3/d3",
        humane: "lib/humane/humane",
        lib: "lib"
    }
};
</script>

<script type='text/javascript' src="lib/jstat.js"></script>
<script type='text/javascript' src="lib/canvg/rgbcolor.js"></script>
<script type='text/javascript' src="lib/canvg/canvg.js"></script>
<script type='text/javascript' src="lib/lodash.js"></script>
<script type='text/javascript' src="lib/fileSaver/Blob.js"></script>
<script type='text/javascript' src="lib/fileSaver/FileSaver.js"></script>
<script src="lib/require.min.js"></script>

<script>
    function calculateAjaxPath() {
        if (!window["ajaxurl"]) {
            var path = window.location.href;
            console.log("window.location.href", path);
            var baseDirectoryPosition = path.indexOf("/wp-content/");
            if (baseDirectoryPosition !== -1) {
                window["ajaxurl"] = path.substring(0, baseDirectoryPosition) + "/wp-admin/admin-ajax.php";
                console.log("set ajaxurl to", window["ajaxurl"]);
            }
        }
    }
    calculateAjaxPath();
</script>

</head>

<body>
    <noscript>Please enable JavaScript to use NarraFirma. NarraFirma is companion software to the book Working With Stories in Your Community or Organization.</noscript>
    <div id="pleaseWaitDiv" class="pleaseWaitOverlay" style="display: none">Starting up NarraFirma; please wait...</div>
    <script>console.log("started loading..."); document.getElementById("pleaseWaitDiv").style.display="block";</script>
    
    <div id="navigationDiv" style="display: none"></div>
    <div id="pageDiv" style="overflow: auto; display: none;"></div>
    <div id="toasterDiv"></div>
    <div id="dialogDiv"></div>
    <script>
    // Load text with plugins here because TypeScript IDE does not like it elsehwere
    require([
        "js/main",
        "lib/text!recommendations/recommendations_filledin.csv",
        "lib/text!recommendations/recommendations_intervention_filledin.csv"
    ], function(
        main,
        recommendationsText,
        recommendationsInterventionText
    ) {
        // Load these here because TypeScript does not like the plugin use for the text plugin
        window["narraFirma_recommendationsText"] = recommendationsText;
        window["narraFirma_recommendationsInterventionText"] = recommendationsInterventionText;
        
        console.log("Launching main application");
        main.run();
    });
    </script>
</body>

</html>

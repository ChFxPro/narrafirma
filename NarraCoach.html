<!DOCTYPE html>
<html>

<head>
<title>NarraCoach</title>
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.10.0/dojo/resources/dojo.css">
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.10.0/dijit/themes/dijit.css">
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.10.0/dijit/themes/claro/claro.css">
<style type="text/css">
  @import "http://ajax.googleapis.com/ajax/libs/dojo/1.10.0/dojox/grid/resources/claroGrid.css";

  /*Grid needs an explicit height by default*/
  #gridDiv {
      height: 30em;
  }
</style>
<script>dojoConfig = {async: true, parseOnLoad: false}</script>
<script src="http://ajax.googleapis.com/ajax/libs/dojo/1.10.0/dojo/dojo.js"></script>
</head>

<body class="claro">
  <b>NarraCoach</b><br>
  
  <div id="questionsDiv"></div>
  <div id="testDiv"></div>
  
  <script>
require(["dijit/form/Button", "dojo/dom", "dijit/Dialog", "dojo/on", "dojo/domReady!"], function(Button, dom, Dialog, on){

  function insertQuestionIntoDiv(question, questionsDiv) {
    var questionDiv = document.createElement("div");
    // console.log("question", question);
    var input = '<input type="text" name="' + question.id + '">';
    if (question.type === "boolean") {
      input = '<input type="radio" name="' + question.id + '" value="No"> No <input type="radio" name="' + question.id + '" value="Yes"> Yes ';
    }
    var help = "";
    if (question.help) {
      var helpText = question.help.replace(/\"/g, '\\x22').replace(/\'/g, '\\x27');;
      help = ' <button onclick="alert(\'' + helpText + '\')">?</button>';
    }
    questionDiv.innerHTML = "  <b>" + question.index + ". </b>" + question.text + " " + input + help + "<br>";
    questionsDiv.appendChild(questionDiv);
  }
  
  function showQuestionEditDialog(question, questionsDiv) {
    var form = document.createElement("div");
    // "<pre>" + JSON.stringify(question) + "</pre>"
    insertQuestionsIntoDiv(createSurveyQuestions, form);
  
    var myDialog = new Dialog({
      title: "My Dialog",
      content: form,
      style: "width: 300px"
    });

    myDialog.show();
  }
    
  function insertQuestionEditorIntoDiv(question, questionsDiv) {
    var questionEditorDiv = document.createElement("div");
    var editButton = document.createElement("button");
    editButton.setAttribute("type", "button");
    editButton.appendChild(document.createTextNode("Edit question " + question.index));
    /* var editButton = new Button({
      label: "Edit question " + question.index, 
      onClick: function() {
        myDialog.show();
      }
    });
    */
    //editButton.startup();
    //on(editButton, "click", myTest);
    //editButton.placeAt(questionEditorDiv);
    editButton.onclick = function() {showQuestionEditDialog(question, questionsDiv);};
    questionEditorDiv.appendChild(editButton);
    questionEditorDiv.appendChild(document.createElement("br"));
    insertQuestionIntoDiv(question, questionEditorDiv);
    questionEditorDiv.appendChild(document.createElement("br"));
    questionsDiv.appendChild(questionEditorDiv);
  }
  
  function insertQuestionsIntoDiv(questions, questionsDiv) {
	  for (var questionIndex in questions) {
		var question = questions[questionIndex];
		question.index = questionIndex;
		insertQuestionIntoDiv(question, questionsDiv)
	  }
  }

  var testPuppyQuestions = [
    {id: "name", type: "text", text: "Your Name", help: 'Please enter your \'full\' name, like "John Smith".'},
    {id: "wantPuppy", type: "boolean", text: "Do you want a free puppy today?", help: "Enter yes or no"},
    {id: "reason", type: "text", text: "If yes, why do you want a free puppy?"},
  ];
  
  var createSurveyQuestions = [
    {id: "questionID", type: "text", text: "Question ID", help: 'TODO'},
    {id: "questionType", type: "text", text: "Question Type", help: 'TODO'},
    {id: "questionText", type: "text", text: "Question Text", help: 'TODO'},
    {id: "questionHelp", type: "text", text: "Question Help", help: 'TODO'},
  ];
  
  var questionsDiv = document.getElementById("questionsDiv");
  //insertQuestionsIntoDiv(testPuppyQuestions, questionsDiv);
  // insertQuestionsIntoDiv(createSurveyQuestions, questionsDiv);
  
  // TODO: Challenge of repeating sections....
      
  function addQuestion() {
    questionsDiv.innerHTML += "<div>Add question button pressed at: " + Date.now() + "</div>";
  }
  
  var questionIndex = 1;
  
  // Create a button programmatically:
  var myButton = new Button({
    label: "Add question",
    onClick: function(){
      var question = {index: questionIndex, id: "Q" + questionIndex, type: "text", text: "Question text " + questionIndex, help: 'Question help ' + questionIndex};
      questionIndex += 1;
      insertQuestionEditorIntoDiv(question, questionsDiv);
    }
  }, "testDiv").startup();
  
});
  </script>
</body>

</html>
